/**
* DevExtreme (cjs/__internal/grids/tree_list/module_not_extended/ai_column.integration.test.js)
* Version: 26.1.0
* Build date: Tue Jan 13 2026
*
* Copyright (c) 2012 - 2026 Developer Express Inc. ALL RIGHTS RESERVED
* Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/
*/
"use strict";

var _globals = require("@jest/globals");
var _renderer = _interopRequireDefault(require("../../../../core/renderer"));
var _tree_list = _interopRequireDefault(require("../../../../ui/tree_list"));
var _ai_integration = require("../../../core/ai_integration/core/ai_integration");
var _tree_list2 = require("../../../grids/tree_list/__tests__/__mock__/model/tree_list");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const SELECTORS = {
  treeListContainer: '#treeListContainer'
};
const TREELIST_CONTAINER_ID = 'treeListContainer';
const items = [{
  id: 1,
  parentId: 0,
  name: 'Name 1',
  value: 10
}, {
  id: 2,
  parentId: 1,
  name: 'Name 2',
  value: 20
}];
const createTreeList = async function () {
  let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  return new Promise(resolve => {
    const $container = (0, _renderer.default)('<div>').attr('id', TREELIST_CONTAINER_ID).appendTo(document.body);
    const instance = new _tree_list.default($container.get(0), options);
    const component = new _tree_list2.TreeListModel($container.get(0));
    _globals.jest.runAllTimers();
    resolve({
      $container,
      component,
      instance
    });
  });
};
const beforeTest = () => {
  _globals.jest.useFakeTimers();
};
const afterTest = () => {
  const $container = (0, _renderer.default)(SELECTORS.treeListContainer);
  const treeList = $container.dxTreeList('instance');
  treeList.dispose();
  $container.remove();
  _globals.jest.clearAllMocks();
  _globals.jest.useRealTimers();
};
(0, _globals.describe)('AI data', () => {
  (0, _globals.beforeEach)(beforeTest);
  (0, _globals.afterEach)(afterTest);
  (0, _globals.describe)('when prompt is set', () => {
    (0, _globals.it)('should be rendered', async () => {
      const {
        component
      } = await createTreeList({
        dataSource: items,
        keyExpr: 'id',
        parentIdExpr: 'parentId',
        autoExpandAll: true,
        columns: [{
          dataField: 'id',
          caption: 'ID'
        }, {
          dataField: 'name',
          caption: 'Name'
        }, {
          dataField: 'value',
          caption: 'Value'
        }, {
          type: 'ai',
          caption: 'AI Column',
          name: 'myColumn',
          ai: {
            prompt: 'Initial prompt',
            aiIntegration: new _ai_integration.AIIntegration({
              sendRequest() {
                return {
                  promise: new Promise(resolve => {
                    resolve('{"1":"AI Response 1","2":"AI Response 2"}');
                  }),
                  abort: () => {}
                };
              }
            })
          }
        }]
      });
      (0, _globals.expect)(component.getDataCell(0, 3).getText()).toBe('AI Response 1');
      (0, _globals.expect)(component.getDataCell(1, 3).getText()).toBe('AI Response 2');
    });
  });
});
